---
title: "Final Rep"
author: "Sewheat Haile"
date: "4/1/2021"
output: pdf_document
---

```{r setup}

library(pacman)
p_load(tidyverse, stargazer, kableExtra, ipumsr, dplyr)

# load data via IPUMS instructions
ddi <- read_ipums_ddi("data/usa_00002.xml")
data <- read_ipums_micro(ddi)

str(data)
```

FROM XIYAN:
“We restrict estimation of the earnings equation to the economically active black and white population age 25 to 59, after eliminating the top and bottom earning percentiles from the analysis.”
I think they eliminated the top and bottom percentiles first. -Xiyan

FROM DI:
make sure to calculate the index of dissimilarity b/c they do that in the paper

```{r clean data-race}

# remove detailed hispanic and race columns as filtering can be done using the basic columns 
data_clean <- data %>%
  select(-HISPAND, -RACED)

# only include observations of non-hispanic
data_clean <- data_clean %>%
  filter(HISPAN == 0)

# only include observations of white and black
data_clean <- data_clean %>%
  filter(RACE %in% c(1, 2))
```


```{r clean data-occ1990}
# eliminate unknown occupations in OCC1990
data_clean <- data_clean %>%
  filter(OCC1990 < 999)

# load crosswalk to convert occ1990 to two-digit scheme
crosswalk <- read.csv("occ_crosswalk.csv")

# rename to make variables match in both data frames
crosswalk <- crosswalk %>%
  rename(OCC1990 = occ1990) %>%
  rename(OCC_2DIGIT = occ_2digit) %>%
  rename(OCC1990_LABELS = occ1990_labels)

# join data frame by OCC1990 variable
data_clean <- left_join(data_clean, crosswalk)

# remove OCC1990 as it is no longer necessary
data_clean <- data_clean %>%
  select(-OCC1990)
```

```{r clean data-incwage}
# filter out economically inactive people and NAs
####### is this the right spot for this??
data_clean <- data_clean %>%
  filter(LABFORCE == 2)

# remove NA (999999) or Missing (999998) observations from INCWAGE
######### i do this first right???
data_clean <- data_clean %>%
  filter(INCWAGE < 999998)

# adjust wages for inflation -> set to 1999 dollars
# (2000 census already set to 1999 dollars)
data_clean <- data_clean %>%
    mutate(
    INCWAGE_ADJ = ifelse(YEAR == 1980,       # if `year` equals 1980,
                    INCWAGE*2.295,           # then `incwage_adj` equals incwage*2.295,
                    INCWAGE)) %>%            # else `incwage_adj` equals 'incwage'
    mutate(
    INCWAGE_ADJ = ifelse(YEAR == 1990,       # if `year` equals 1990,
                    INCWAGE*1.344,           # then `incwage_adj` equals incwage*1.344,
                    INCWAGE_ADJ)) %>%        # else `incwage_adj` stays the same
    mutate(
    INCWAGE_ADJ = ifelse(YEAR == 2010,       # if `year` equals 2010,
                    INCWAGE*0.777,           # then `incwage_adj` equals incwage*0.777,
                    INCWAGE_ADJ))            # else `incwage_adj` stays the same

# determine top and bottom 1% of earnings (after adjusting for inflation) 
######### is this the right place for this step???
quantile(data_clean$INCWAGE_ADJ, c(.01, .99))

# eliminate top and bottom earning percentiles (after adjusting for inflation)
#### is this correct????
data_clean <- data_clean %>%
  filter(INCWAGE_ADJ > 0) %>%
  filter(INCWAGE_ADJ < 150000)

######### remove INCWAGE as it is no longer necessary (????? so i don't confuse myself)
data_clean <- data_clean %>%
  select(-INCWAGE)

# restrict age to 25 - 59
data_clean <- data_clean %>%
  filter(AGE >= 25) %>%
  filter(AGE <= 59)

# 1. create new variable of weekly wage by dividing annual wages by weeks worked
# 2. create new variable of log weekly wages
# 3. create new variable of log working hours
data_clean <- data_clean %>%
  mutate(WKWAGE = INCWAGE_ADJ / WKSWORK2) %>%
  mutate(WKWAGE_LOG = log(WKWAGE)) %>%
  mutate(UHRSWORK_LOG = log(UHRSWORK))

str(data_clean)
```
